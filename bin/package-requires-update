#!/usr/bin/env node

var exec = require( 'child-process-promise' ).exec;
var packageJson;
var semver = require( 'semver' );

if ( !process.argv[2] ) {
	console.log( 'This script requires that you provide arguments' );
}

try {
	packageJson = require( '../' + process.argv[2] );
} catch ( e ) {
	console.log( 'Failure: ', e );
}

if ( packageJson.private ) {
	process.exitCode = 0;
}

if ( /[^A-Za-z0-9_\/:=-]/.test( packageJson.name ) ) {
	console.log( packageJson.name, 'Package name cannot contain spaces and/or invalid characters' );
	console.log( '\n' );
	process.exitCode = 1;
} else {
	exec( 'npm view ' + packageJson.name + ' version' )
		.then( function( result ) {
			if ( semver.gt( packageJson.version, result.stdout ) ) {
				process.exitCode = 0;
			} else {
				console.log( packageJson.name, 'Package must be versioned' );
				console.log( '\n' );
				process.exitCode = 1;
			}
		} );
}
